# Hearable HeadTracker
---
## Overview
Hearable HeadTrackerはヒアラブルデバイス（フォスター電機 RN002）に実装されているヘッドトラッキング機能のフロントエンドアプリケーションです。

WebBluetoothを用いてヒアラブルデバイスRN002からデータ取得を行い、ブラウザに表示されているオブジェクトの回転、およびWebSocket経由で任意の宛先に送出します。\
オブジェクトの回転およびWebSocketのデータは、ヒアラブルデバイスのジャイロセンサー／加速度センサーの出力をMadgwickフィルタにより四元数（Quaternion）に変換しており、Thress.jsやUnityなどの3Dオブジェクト制御に使用することが可能です。

## 対応ブラウザ
WebBluetoothに対応したブラウザ　参考：[ブラウザー互換性一覧表 Mozilla.org](https://developer.mozilla.org/ja/docs/Web/API/Web_Bluetooth_API#ブラウザーの互換性)

#### 動作することを確認しているブラウザ
- Chrome（Windows,Mac）
- Edge（Windows,Mac）
  
#### 動作しないことを確認しているブラウザ
- Safari（Mac,iOS）



## 操作インターフェース
<img src="Panel.png" width="450">

#### ① Object
ヒアラブルデバイスより送られてくるデータに合わせて回転します。\
接続直後や大きく回転した直後にはフィルタによる補正が動作し、ヒアラブルデバイスが動いていない場合であっても適切な位置まで徐々に回転することがあります。

#### ② Controls
- Start Notify：クリックするとヒアラブルデバイスとの接続ウィンドウが表示されます（接続後、データが送られてくるまで20秒程度かかる場合があります）
- Stop Notify：ヒアラブルデバイスとの接続を解除する場合にクリックします。再度接続したい場合にはブラウザをリロードしてください。
- Reposition：Objectの向きを正面に戻します。ヒアラブルデバイスの実際の向きとObjectの向きを合わせる場合にクリックしてください。

#### ③ WebSocket
- WebSocket URL：WebSocketで接続するURLを指定してください。
- Connect：WebSocket URLとの接続/切断を行います。本ページがロードされた直後に自動的に接続を試みます。
  
#### ④ Status
- 接続しているデバイス名や受信したデータの種別やデータ数を表示します

## WebSocketでの拡張
WebSocketで送られてきたヒアラブルデバイスの回転データを各製品のAPIに渡すことにより、任意のアバターやロボットなどの制御を行うことが可能になります。

<img src="Expand.png" width="450">

#### WebSocketデータフォーマット
コンマ区切りで下記順序のデータ列を送出します。

|   | データ種別 | フォーマット |
|-|-|-|
| 1 | ステータス | bit7-2:使用せず、bit1:タッチ操作(1:ON、0:OFF)、bit0:装着(1:ON、0:OFF) |
| 2 | W軸 | Float値によるW軸データ（クウォータニオン） |
| 3 | X軸 | Float値によるX軸データ（クウォータニオン） |
| 4 | Y軸 | Float値によるY軸データ（クウォータニオン） |
| 5 | Z軸 | Float値によるZ軸データ（クウォータニオン） |


## 注意事項
- ヒアラブルデバイスに接続してからオブジェクトが回転するまで最大で20秒程度の時間がかかる場合があります。
- 左右のヒアラブルデバイスを使用している場合、状況に応じて自動的にどちらか片側のヒアラブルデバイスからのセンサー情報を取得します。\
  左右の任意のデバイスからデータ取得を行いたい場合、使用しないヒアラブルデバイスはチャージケースに収納してください。


※このアプリケーションはヒアラブルデバイス（フォスター電機 RN002）の評価を目的としてMITライセンスの下に公開しております。
※ワイヤレス通信は周囲の状況によりデータ欠落や再送・遅延が発生します。これらの事象を考慮したうえでセンサーデータをご利用ください。

